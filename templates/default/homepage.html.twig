{% extends 'base.html.twig' %}

{% block title %}Page d'accueil!{% endblock %}

{% block body %}
    <main class="homepage">
        <h1 class="homepage__title">Bienvenue sur Troc time</h1>
        <section class="homepage__presentation">
            <p class="homepage__presentation__content">
                Cette application spécialisé dans la mise en relation entre personne vivant
                dans le même secteur afin de s'échanger des services et des compétences.
                Vous avez la possibilité de poster des annonces où de contacter directement
                les membres de la communité via la messagerie privé.
            </p>
        </section>
        <button class="header__nav__button">
            <a href="{{ path('announcement_list') }}" class="header__nav__button__link"><i class="las la-search"></i> Recherche par annonce</a>
        </button>
        <button class="header__nav__button">
            <a href="{{ path('profile_list') }}" class="header__nav__button__link"><i class="las la-search"></i> Rechercher membre de la communauté</a>
        </button>
        {# <h2 class="homepage__subtitle">Liste des catégories</h2>
        <ul>
            {% for category in categories %}
                <li>{{category.name}}</li>
                <ul>
                    {% for subCategory in category.subCategories %}
                        <li>{{ subCategory.name }}</li>
                    {% endfor %}
                </ul>
            {% endfor %}
        </ul> #}
        <h2 class="homepage__subtitle">Dernières annonces publiées</h2>
        <section class="homepage__announcements">
            {% for announcement in announcements %}
                <a href="{{ path('announcement_view', {'id': announcement.id}) }}" class="homepage__announcement__link">
                    <article class="homepage__announcement">
                        <div class="homepage__announcement__top">
                            <div class="homepage__announcement__top__profile">
                                {% if announcement.profile.filename %}
                                    <img src={{ vich_uploader_asset(announcement.profile, 'imageFile')}} alt="image de profil de {{ announcement.profile.username }})" class="homepage__announcement__top__profile__img">
                                {% else %}
                                    <img src="{{ asset('images/profil.jpeg') }}" alt="image de profil vide (grisé)" class="homepage__announcement__top__profile__img">
                                {% endif %}
                                    <p class="homepage__announcement__top__profile__username">{{ announcement.profile.username }}</p>
                            </div>            
                            <p class="homepage__announcement__top__date">{{ announcement.profile.createdAt|date('d/m/Y') }}</p>
                        </div>
                        <div class="homepage__announcement__middle">
                            <div class="homepage__announcement__middle__left">
                                {% if announcement.pictures %}
                                    {% for picture in announcement.pictures %}
                                        {% if loop.first %}
                                            <img class="homepage__announcement__middle__left__img" src="{{ vich_uploader_asset(picture, 'imageFile')}}" alt="image de l'annonce {{ announcement.title }}">
                                        {% endif %}
                                    {% else %}
                                        <img class="homepage__announcement__middle__left__img" src="{{ asset('images/empty.jpg') }}" alt="image annonce vide">
                                    {% endfor %}
                                {% endif %}
                            </div>
                            <div class="homepage__announcement__middle__right">
                                <h3 class="homepage__announcement__middle__right__title">{{ announcement.title }}</h3>
                                <p class="homepage__announcement__middle__right__description">{{ announcement.description }}</p>
                            </div>
                        </div>
                        <div class="homepage__announcement__bottom">
                            <div class="homepage__announcement__bottom__content">
                                <p class="homepage__announcement__bottom__content__propose"><i class="las la-exchange-alt la-lg"></i> Je propose en échange : {{ announcement.propose }}</p>
                                <p class="homepage__announcement__bottom__content__category"><i class="las la-tag la-lg"></i> {{ announcement.subCategory.category.name }} / {{ announcement.subCategory.name }}</p>
                                <p class="homepage__announcement__bottom__content__city"><i class="las la-map-marker-alt la-lg"></i> {{ announcement.region }} / {{ announcement.department }} / {{ announcement.city }}</p>
                            </div>
                            <div class="homepage__announcement__bottom__favorite">
                                {% if is_granted("ROLE_USER") %}
                                    {% if app.user.profile %}
                                        {% set isFavorite = false %}
                                        {% for favoris in announcement.favorites %}
                                            {% if favoris.id == app.user.profile.id %}
                                                {% set isFavorite = true %}
                                            {% endif %}    
                                        {% endfor %}
                                        {% if isFavorite %}
                                            <a href="{{ path('announcement_remove_favorite', {id: announcement.id}) }}"><i class="las la-heart la-2x"></i></a>
                                        {% else %}
                                            <a href="{{ path('announcement_add_favorite', {id: announcement.id}) }}"><i class="lar la-heart la-2x"></i></a>
                                    {% endif %}
                                    {% else %}
                                        <i class="lar la-heart la-2x"></i>
                                    {% endif %}
                                {% endif %}
                            </div>
                        </div>                        
                    </article>
                </a>
            {% endfor %}
        </section>
    </main>
{% endblock %}